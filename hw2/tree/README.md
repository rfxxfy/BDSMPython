# Кеша и Экология

## Легенда

В перерыве между просмотром сериалов попугай Кеша краем глаза увидел рекламу движения в защиту
окружающей среды. И что бы Вы подумали - да, наш друг захотел стать зоозащитником и экоактивистом.
Не зная с чего начать, он включил ранее найденный компьютер и удалил утилиту `tree`. Негоже деревьям
расти вне природы!

К Кешиному сожалению, выяснилось, что это достаточно полезная утилита, которая никак не связана с
экологией. Вовка, как назло, отключил домашний интернет, а утилита нужна здесь и сейчас. Вам нужно
написать аналог программы, чтобы помочь бедному попугаю.

## Пояснение

Утилита `tree` позволяет пользователю увидеть древовидное представление его файловой системы.
Давайте покажем пример, чтобы стало более понятно:

```console
$ tree /home/dev/kesha/
/home/dev/kesha/
├── cinema/
│   ├── american-psycho.mp4
│   └── fight-club.mp4
├── music/
│   ├── 3rd-september.mp3
│   ├── blood-type.mp3
│   └── metamorphosis.mp3
└── README.md
```

Такое представление говорит следующее о директории `/home/dev/kesha/`:

* Есть две директории: `cinema/` и `music/`;
* Есть один файл: `README.md`.

В директории `/home/dev/kesha/cinema/` есть два файла:

* `american-psycho.mp4`;
* `fight-club.mp4`.

В директории `/home/dev/kesha/cinema/` есть три файла:

* `3rd-september.mp3`;
* `blood-type.mp3`;
* `metamorphosis.mp3`.

## Техническое задание

Используя модуль `argparse`, Вам необходимо реализовать консольную утилиту, которая будет иметь
аналогичное поведение. Ниже будет описано, какими свойствами должна обладать программа.

### Порядок вывода

Выводить требуется только регулярные файлы и директории. Сначала выводите директории, затем
регулярные файлы. Соблюдайте лексикографический порядок.

Символические ссылки и прочие *особенные* объекты файловой системы игнорируйте. В выводе они
участвовать не должны.

На первой строке выводите нормализованный путь, который был передан в качестве аргумента. Если
никакой путь не был передан, то используйте текущую директорию.

### Отступы

Для простоты реализации вместо черточек будем использовать пробелы.

Вместо такого:

```console
$ tree /home/dev/kesha/
/home/dev/kesha/
├── cinema/
│   ├── american-psycho.mp4
│   └── fight-club.mp4
├── music/
│   ├── 3rd-september.mp3
│   ├── blood-type.mp3
│   └── metamorphosis.mp3
└── README.md
```

Будем выводить такое:

```console
$ tree /home/dev/kesha/
/home/dev/kesha/
    cinema/
        american-psycho.mp4
        fight-club.mp4
    music/
        3rd-september.mp3
        blood-type.mp3
        metamorphosis.mp3
    README.md
```

Число пробелов регулируется опцией `-i` или `--indent`. Значение по умолчанию равно `4`. Число строго положительно.

Например, если отступ равен двум, то вывод будет таким:

```console
$ tree --indent 2 /home/dev/kesha/
/home/dev/kesha/
  cinema/
    american-psycho.mp4
    fight-club.mp4
  music/
    3rd-september.mp3
    blood-type.mp3
    metamorphosis.mp3
  README.md
```

### Пустые директории

По умолчанию предлагаем выводить пустые директории:

```console
$ tree /home/dev/kesha/
/home/dev/kesha/
    empty/
    music/
        3rd-september.mp3
        blood-type.mp3
        metamorphosis.mp3
    README.md
```

Однако это поведение требуется отключать при наличии флага `-p` или `--prune`:

```console
$ tree --prune /home/dev/kesha/
/home/dev/kesha/
    music/
        3rd-september.mp3
        blood-type.mp3
        metamorphosis.mp3
    README.md
```

То же касается директорий, в которые вложены пустые директории:

```console
$ tree /home/dev/kesha/
/home/dev/kesha/
    empty/
        empty1/
        empty2/
    music/
        3rd-september.mp3
        blood-type.mp3
        metamorphosis.mp3
    README.md
```

После поднятия флага:

```console
$ tree --prune /home/dev/kesha/
/home/dev/kesha/
    music/
        3rd-september.mp3
        blood-type.mp3
        metamorphosis.mp3
    README.md
```

### Глубина поиска

Иногда полезно *не слишком углубляться*. Используя опцию `-d` или `--depth`, пользователь может
ограничить глубину вывода. Файлы на указанной глубине требуется выводить. Нуль разрешен.

Файлы, которые лежат "на поверхности", считать за единичную глубину.

```console
$ tree --depth 0 /home/dev/kesha/
/home/dev/kesha/
```

```console
$ tree --depth 1 /home/dev/kesha/
/home/dev/kesha/
  cinema/
  music/
  README.md
```

```console
$ tree --depth 2 /home/dev/kesha/
/home/dev/kesha/
  cinema/
    american-psycho.mp4
    fight-club.mp4
  music/
    3rd-september.mp3
    blood-type.mp3
    metamorphosis.mp3
  README.md
```

### Поток вывода

По умолчанию требуется использовать стандартный поток вывода (`sys.stdout`).

Тем не менее требуется предусмотреть возможность перенаправить вывод в некоторый файл. Для этого
будут использованы опции `-o` и `--output`.

```console
$ tree --output ./file.txt /home/dev/kesha/
$ cat ./file.txt
/home/dev/kesha/
    cinema/
        american-psycho.mp4
        fight-club.mp4
    music/
        3rd-september.mp3
        blood-type.mp3
        metamorphosis.mp3
    README.md
```

Если файл уже существует, то его разрешено переписать. Для любого другого объекта файловой системы
примените алгоритм из секции *"Ошибки"*. Если файл вложен в директорию, дерево которой требуется
вывести, то файл включается в это вывод этого дерева.

### Расширения файлов

Давайте также предусмотрим возможность добавлять фильтры на расширения через опциональный параметр
`-e` или `--extension`. Учтите, что опцию можно передать несколько раз - и каждый раз должен быть
учтен. Первая точка в имени расширения не обязательна.

```console
$ tree -e .mp4 -e mp3 /home/dev/kesha/
/home/dev/kesha/
    cinema/
        american-psycho.mp4
        fight-club.mp4
    music/
        3rd-september.mp3
        blood-type.mp3
        metamorphosis.mp3
```

Вместе с опцией автоматически включается `--prune`. Пустые директории - в том числе, те, что стали
пустыми из-за фильтров на расширение - не выводятся.

```console
$ tree --extension .mp4 /home/dev/kesha/
/home/dev/kesha/
    cinema/
        american-psycho.mp4
        fight-club.mp4
```

### Ошибки

В случае каких-либо ошибок завершайте работу программы через `argparse.ArgumentParser.error`.

Примеры:

* В качестве аргумента передана не директория;
* В качестве отступа передано отрицательное число;
* В качестве аргумента передана несуществующая директория.

### Прочее

Обязательно учитывайте следующие требования:

* Опции консольной утилиты требуется сопровождать описанием. Если какая-то из опций требует
  аргумента, то не забывайте использовать `metavar` для более явного именования.

* В первой строке всегда выводите нормализованный абсолютный путь в стиле `POSIX`. В частности,
  требуется осуществлять подстановку домашней директории. Если это невозможно, то завершайте работу
  с ошибкой.

* Директории, отображаемые в дереве, обязательно сопровождаются слешами на конце.

* Имя программы - строго `tree`.

## Подсказки

Вам наверняка пригодятся:

- `pathlib.Path.iterdir`.

## Тестирование

При локальном тестировании не забывайте добавлять опцию `--capture=sys`:

```console
$ pytest --capture=sys .
...
```
